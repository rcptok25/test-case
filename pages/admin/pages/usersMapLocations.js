import { useDemo, useState, useEffect } from 'react'
import GoogleMapReact from 'google-map-react';
import Head from "next/head";
import SideNavBar from './../component/SideNavbar'
import axios from '../../apiConfig/axios';





export default function usersMapLocations() {

  const [name, setName] = useState()
  const [surname, setSurname] = useState()
  const [username, setUsername] = useState()




  const [latLng, setLatLng] = useState();
  const [maps, setMaps] = useState(null);
  const [map, setMap] = useState(null);

  const [location, setLocation] = useState("Maps Location")

  const [selectedUser, setSelectedUser] = useState()

  useEffect(() => {


    setSelectedUser(window.sessionStorage.getItem("Registeruser"));

    console.log(selectedUser)
    if (selectedUser !== "") {


      axios.post(`userData.php`, { selectedUser }).then(response => {
        setUsername(window.sessionStorage.getItem("Registeruser"))
        setSurname(response.data.Surname)
        setName(response.data.Name)


      })
    }
    else {
      setSelectUser("Select User")
    }
  })


  const MapMarker = ({ position, maps, map }) => {

    useEffect(() => {

      const marker = new maps.Marker({
        position,
        map,
        title: "Hello World!",
      });
      setLocation("Lat: " + position?.lat + ", Lng: " + position?.lng)
    }, [position?.lat, position?.lng])
    return (
      <></>
    )

  }



  const handleApiLoaded = (map, maps) => {
    setMap(map);
    setMaps(maps);
    map.setOptions({

      fullscreenControl: false,
      mapTypeControl: true,
      mapTypeControlOptions: {


        style: maps.MapTypeControlStyle.DEFAULT,
        position: maps.ControlPosition.TOP_CENTER,
        mapTypeIds: ["roadmap", "satellite"],
      },
      zoomControl: false,
    });
  };

  const defaultProps = {
    center: {
      lat: 10.99835602,
      lng: 77.01502627
    },
    zoom: 11
  };


  return (
    <>
      <Head>
        <title>Test Case - Users Map Locations</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/pro.ico" />
      </Head>
      <div className="md:flex min-h-screen relative">
        <SideNavBar />
        <div className="md:flex w-full p-10 min-h-screen flex-col justify-start">
          <h1 className="text-xl font-bold">User Map Locations</h1>
          <div className='md:flex w-full flex-col justify-start items-start mb-1 '>
            <form action="#" method="POST" className=' mt-6 md:flex w-full flex-row justify-start items-start '>

              <div className='w-1/5'>
                <label className="block text-gray-700 w-1/5">Username</label>
                <select onChange={(e) => console.log(e.target.value)} className="w-full  px-4 py-3 rounded-lg bg-gray-200 mt-2 border focus:border-blue-500 focus:bg-white focus:outline-none">
                  <option value="a">a</option>
                  <option selected value="b">b</option>
                  <option value="c">c</option>
                  <option value="d">d</option>
                </select>
              </div>





            </form>

            <div className=' p-10'>
              <label>User Name:  {name}  - User Surname: {surname}  - Username: {username}</label>

            </div>



          </div>
          <div className='w-full h-full'>
            <GoogleMapReact
              bootstrapURLKeys={{ key: "AIzaSyAhkyqtF5czuz-KzzOv3Z8skkl2b_9koDk" }}
              defaultCenter={defaultProps.center}
              defaultZoom={defaultProps.zoom}
              onClick={(e) => { setLatLng(e) }}
              onGoogleApiLoaded={({ map, maps }) => {
                handleApiLoaded(map, maps);
              }}

            >
              {!!latLng ?
                <>
                  <MapMarker map={map} maps={maps} position={latLng}></MapMarker>
                </> : <></>

              }
            </GoogleMapReact>

          </div>









        </div>
      </div>
    </>
  )
}



